<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>üî• IPTV SCANNER ‚Ä¢ MR.XEEROOX üî•</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
:root{
 --bg:#020617;--panel:#020617ee;
 --accent:#22c55e;--text:#e5e7eb;
 --bad:#ef4444;--unk:#facc15;
}
*{box-sizing:border-box}
body{
 margin:0;font-family:Segoe UI,sans-serif;
 background:radial-gradient(circle at top,#1e293b,#020617 60%);
 color:var(--text)
}
header{
 padding:14px;text-align:center;
 background:linear-gradient(270deg,#020617,#16a34a,#020617);
 background-size:400% 400%;animation:grad 8s infinite
}
@keyframes grad{0%{background-position:0}50%{background-position:100%}100%{background-position:0}}
marquee{color:#22c55e;font-weight:bold}

.container{padding:12px}
input,button{
 width:100%;padding:10px;margin:6px 0;
 background:#020617;color:white;
 border:1px solid #1f2937;border-radius:8px
}
button{background:var(--accent);color:black;font-weight:bold;cursor:pointer}

.progress{
 position:relative;height:16px;
 background:#020617;border-radius:999px;overflow:hidden
}
.bar{height:100%;width:0%;background:linear-gradient(90deg,#22c55e,#4ade80);transition:width .3s}
.bar-text{
 position:absolute;inset:0;display:flex;align-items:center;justify-content:center;
 font-size:12px;font-weight:bold;color:#e5e7eb;text-shadow:0 1px 2px #000
}

.stats{display:flex;gap:10px;margin:8px 0}
.stat{flex:1;padding:8px;border-radius:8px;background:#020617;text-align:center}
.ok{color:var(--accent)} .bad{color:var(--bad)} .unk{color:var(--unk)}

.preview{position:relative;margin:12px 0;background:#000;border-radius:12px;overflow:hidden}
.preview video{width:100%;height:220px}

.watermark{
 position:absolute;bottom:6px;right:8px;font-size:11px;opacity:.85;
 background:rgba(0,0,0,.55);padding:4px 8px;border-radius:6px
}

.box{margin-top:14px;background:var(--panel);padding:12px;border-radius:14px}
.box h3{margin:0 0 10px;color:#22c55e}
.list{
 display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:10px
}
.channel{
 padding:8px;border-radius:10px;
 background:linear-gradient(145deg,rgba(255,255,255,.08),rgba(255,255,255,.02));
 cursor:pointer;text-align:center;font-size:13px
}
.channel:hover{outline:2px solid var(--accent)}
</style>
</head>

<body>

<header>
<h2>TV ONLINE MR.XEEROOX</h2>
<marquee scrollamount="10">üî• IPTV SCANNER ‚Ä¢ FREE TOOL üî•</marquee>
</header>

<div class="container">

<input type="file" id="fileInput" accept=".m3u,.m3u8">
<input id="link" placeholder="https://example.com/playlist.m3u">

<button onclick="loadLink()">LOAD PLAYLIST</button>
<button onclick="startScan()">‚ö° SCAN CHANNEL</button>
<button onclick="saveResultM3U()">üíæ SAVE HASIL OK</button>

<div class="progress">
 <div class="bar" id="bar"></div>
 <div class="bar-text" id="barText">Menunggu playlist...</div>
</div>

<div class="stats">
 <div class="stat ok">OK<br><b id="okEl">0</b></div>
 <div class="stat bad">BAD<br><b id="badEl">0</b></div>
 <div class="stat unk">UNKNOWN<br><b id="unkEl">0</b></div>
</div>

<div id="result">Status: Menunggu playlist</div>

<!-- OK PINDAH KE ATAS -->
<div class="box"><h3>‚úÖ CHANNEL OK</h3><div class="list" id="okList"></div></div>

<div class="preview">
 <video id="player" controls playsinline></video>
 <div class="watermark" id="wmText">MR.XEEROOX</div>
</div>

<div class="box"><h3>üì∫ MODE TV</h3><div class="list" id="tvList"></div></div>
<div class="box"><h3>‚ùì CHANNEL UNKNOWN</h3><div class="list" id="unkList"></div></div>

</div>

<!-- HLS.JS CDN -->
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<script>
/* ===== CONFIG ===== */
const WORKER = "https://tvproxy.mr-xeeroox2503.workers.dev/?url=";
const BATCH = 5, TIMEOUT = 6000;

/* ===== STATE ===== */
let channels=[], index=0, ok=0, bad=0, unk=0;
let hlsInstance = null;

/* ===== ELEMENT ===== */
const fileInput=document.getElementById("fileInput");
const link=document.getElementById("link");
const result=document.getElementById("result");
const tvList=document.getElementById("tvList");
const okList=document.getElementById("okList");
const unkList=document.getElementById("unkList");
const bar=document.getElementById("bar");
const barText=document.getElementById("barText");
const okEl=document.getElementById("okEl");
const badEl=document.getElementById("badEl");
const unkEl=document.getElementById("unkEl");
const player=document.getElementById("player");
const wmText=document.getElementById("wmText");

/* ===== LOAD LINK ===== */
async function loadLink(){
 fileInput.value="";
 if(!link.value) return;
 try{
  const text = await fetch(WORKER + encodeURIComponent(link.value)).then(r=>r.text());
  loadPlaylist(text,"Playlist dimuat");
 }catch(e){
  alert("Gagal load link");
 }
}

/* ===== LOAD FILE ===== */
fileInput.addEventListener("change",()=>{
 const f=fileInput.files[0];
 if(!f) return;
 link.value="";
 const r=new FileReader();
 r.onload=e=>loadPlaylist(e.target.result,"File dimuat");
 r.readAsText(f);
});

/* ===== COMMON LOAD ===== */
function loadPlaylist(text,msg){
 channels=[]; index=ok=bad=unk=0;
 tvList.innerHTML=""; okList.innerHTML=""; unkList.innerHTML="";
 parse(text); dedup(); buildTV();
 result.innerText=`${msg}: ${channels.length} channel`;
 bar.style.width="0%"; barText.innerText="Siap scan";
 updateStats();
}

/* ===== PARSE ===== */
function parse(t){
 let cur=null;
 t.split(/\r?\n/).forEach(l=>{
  if(l.startsWith("#EXTINF")){
   cur={name:l.split(",").pop()||"No Name",url:"",status:"UNKNOWN"};
  }else if(l && !l.startsWith("#") && cur){
   cur.url=l.trim(); channels.push(cur); cur=null;
  }
 });
}
function dedup(){
 const m=new Map();
 channels.forEach(c=>{ if(c.url && !m.has(c.url)) m.set(c.url,c); });
 channels=[...m.values()];
}

/* ===== BUILD TV ===== */
function buildTV(){
 channels.forEach(c=>{
  const d=document.createElement("div");
  d.className="channel";
  d.innerText=c.name;
  d.onclick=()=>play(c.url);
  tvList.appendChild(d);
 });
}

/* ===== SCAN ===== */
function startScan(){
 if(!channels.length) return alert("Playlist kosong");
 index=ok=bad=unk=0;
 okList.innerHTML=""; unkList.innerHTML="";
 bar.style.width="0%";
 scanBatch();
}
function scanBatch(){
 if(index>=channels.length){
  bar.style.width="100%";
  barText.innerText=`SELESAI ‚Ä¢ OK:${ok} BAD:${bad} UNK:${unk}`;
  result.innerText="SCAN SELESAI";
  return;
 }
 const batch=channels.slice(index,index+BATCH);
 let done=0;
 batch.forEach(c=>{
  const v=document.createElement("video");
  v.src = WORKER + encodeURIComponent(c.url); // scan via proxy
  v.muted=true;
  let fin=false;
  const end=s=>{
   if(fin) return; fin=true;
   c.status=s;
   if(s==="OK"){ok++; add(okList,c)}
   else if(s==="BAD"){bad++}
   else{unk++; add(unkList,c)}
   done++;
   if(done===batch.length){
    index+=batch.length;
    updateUI();
    setTimeout(scanBatch,100);
   }
  };
  v.oncanplay=()=>end("OK");
  v.onerror=()=>end("BAD");
  setTimeout(()=>end("UNKNOWN"), TIMEOUT);
 });
}

/* ===== UI ===== */
function add(list,c){
 const d=document.createElement("div");
 d.className="channel";
 d.innerText=c.name;
 d.onclick=()=>play(c.url);
 list.appendChild(d);
}
function updateUI(){
 const p=Math.floor((index/(channels.length||1))*100);
 bar.style.width=p+"%";
 barText.innerText=`Scanning ${index}/${channels.length} | OK:${ok} BAD:${bad} UNK:${unk}`;
 updateStats();
}
function updateStats(){
 okEl.innerText=ok; badEl.innerText=bad; unkEl.innerText=unk;
}

/* ===== PLAY (HLS + NON-HLS) ===== */
function play(url){
 if(!url) return;

 // cleanup
 if(hlsInstance){ hlsInstance.destroy(); hlsInstance=null; }
 player.pause(); player.removeAttribute("src"); player.load();

 if(url.includes(".m3u8")){
  if(window.Hls && Hls.isSupported()){
   hlsInstance = new Hls({enableWorker:true, lowLatencyMode:true});
   hlsInstance.loadSource(url);
   hlsInstance.attachMedia(player);
   hlsInstance.on(Hls.Events.MANIFEST_PARSED, ()=>player.play());
  }else if(player.canPlayType("application/vnd.apple.mpegurl")){
   player.src=url; player.play();
  }else{
   alert("HLS tidak didukung di browser ini");
  }
 }else{
  player.src=url; player.play();
 }
}

/* ===== SAVE OK ===== */
function saveResultM3U(){
 const okc=channels.filter(c=>c.status==="OK");
 if(!okc.length) return alert("Tidak ada channel OK");
 let m="#EXTM3U\n";
 okc.forEach(c=>m+=`#EXTINF:-1,${c.name}\n${c.url}\n`);
 const a=document.createElement("a");
 a.href=URL.createObjectURL(new Blob([m],{type:"audio/x-mpegurl"}));
 a.download="hasil_OK.m3u";
 a.click();
}

/* ===== WATERMARK ===== */
setInterval(()=>{
 wmText.innerText="MR.XEEROOX ‚Ä¢ "+new Date().toLocaleString("id-ID");
},1000);
</script>

</body>
</html>